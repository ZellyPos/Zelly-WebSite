{% extends 'base.html' %}
{% load static %}

{% block title %}Blog - ZELLY Premium POS{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="premium-page-header text-center">
    <div class="container">
        <div class="section-label">Blog</div>
        <h1 class="premium-title">Foydali Ma'lumotlar va Yangiliklar</h1>
        <p class="section-description mx-auto">Restoran biznesini rivojlantirish bo'yicha ekspert maslahatlari va ZELLY
            yangiliklari.</p>
    </div>
</section>

<!-- Blog Grid -->
<section class="blog-grid-section">
    <div class="container">
        <div class="row g-4">
            {% for post in posts %}
            <div class="col-lg-4 col-md-6">
                <article class="blog-card" data-title="{{ post.title }}" data-content="{{ post.content|linebreaks }}"
                    data-date="{{ post.date|date:'d-F, Y' }}" data-category="{{ post.category }}">
                    <div class="blog-image">
                        {% if post.image %}
                        <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-fluid w-100 h-100"
                            style="object-fit: cover;">
                        {% else %}
                        <div class="blog-placeholder-image">{{ post.emoji }}</div>
                        {% endif %}
                        <div class="blog-category">{{ post.category }}</div>
                    </div>
                    <div class="blog-body d-flex flex-column">
                        <div class="blog-date">{{ post.date|date:"d-F, Y" }}</div>
                        <h3>{{ post.title }}</h3>
                        <p>{{ post.short_description }}</p>
                        <a href="javascript:void(0)" class="read-more mt-auto d-flex align-items-center gap-2"
                            onclick="openBlogModal(this.closest('.blog-card'))">Davomini o'qish <span>â†’</span></a>
                    </div>
                </article>
            </div>
            {% empty %}
            <div class="col-12 text-center">
                <p>Hozircha blog postlar mavjud emas.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Blog Post Modal -->
<div class="modal fade" id="blogPostModal" tabindex="-1" aria-labelledby="blogPostModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content blog-modal-content">
            <div class="modal-header border-0">
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body blog-modal-body">
                <div class="blog-date" id="modalBlogDate"></div>
                <div class="blog-category" id="modalBlogCategory"
                    style="position: static; display: inline-block; margin-bottom: 1rem;"></div>
                <h2 id="modalBlogTitle" class="modal-blog-title"></h2>
                <div id="modalBlogContent" class="modal-blog-content"></div>
            </div>
        </div>
    </div>
</div>

<!-- Newsletter Section -->
<section class="blog-newsletter text-center">
    <div class="container">
        <h2>Yangiliklarni O'tkazib Yubormang</h2>
        <p>Haftalik foydali maqolalar va chegirmalarni birinchilardan bo'lib oling.</p>
        <form class="row g-3 justify-content-center mt-4">
            <div class="col-md-6">
                <input type="email" placeholder="Email manzilingiz" class="form-control cta-input" required>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn cta-submit w-100">Obuna Bo'lish</button>
            </div>
        </form>
    </div>
</section>

<script>
    function openBlogModal(card) {
        const modalEl = document.getElementById('blogPostModal');
        const title = card.getAttribute('data-title');
        const content = card.getAttribute('data-content');
        const date = card.getAttribute('data-date');
        const category = card.getAttribute('data-category');

        document.getElementById('modalBlogTitle').innerText = title;
        document.getElementById('modalBlogContent').innerHTML = content;
        document.getElementById('modalBlogDate').innerText = date;
        document.getElementById('modalBlogCategory').innerText = category;

        const modal = new bootstrap.Modal(modalEl);
        modal.show();
    }

    function closeBlogModal() {
        const modalEl = document.getElementById('blogPostModal');
        const modal = bootstrap.Modal.getInstance(modalEl);
        if (modal) {
            modal.hide();
        }
    }
</script>
{% endblock %}